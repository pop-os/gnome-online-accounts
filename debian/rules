#!/usr/bin/make -f

-include /usr/share/gnome-pkg-tools/1/rules/gnome-get-source.mk

export DEB_BUILD_MAINT_OPTIONS = hardening=+all
export DEB_LDFLAGS_MAINT_APPEND = -Wl,-z,defs -Wl,-O1 -Wl,--as-needed

%:
	dh $@ --with gir,gnome

override_dh_autoreconf:
	dh_autoreconf --as-needed

override_dh_auto_configure:
	dh_auto_configure -- \
		--libexecdir=\$${prefix}/lib/gnome-online-accounts \
		--enable-gtk-doc \
		--enable-kerberos \
		--enable-media-server \
		--enable-facebook \
		--enable-flickr \
		--enable-telepathy \
		--enable-todoist \
		--enable-windows-live \
		--enable-google \
		--enable-owncloud \
		--enable-pocket \
		--enable-imap-smtp \
		--enable-exchange \
		--enable-foursquare

override_dh_install:
	dh_install --list-missing

override_dh_makeshlibs:
	dh_makeshlibs -V -- -c4

# This can be dropped if Ubuntu ever promotes dleyna-server to 'main'
# https://launchpad.net/bugs/1738448
override_dh_gencontrol:
ifneq ($(shell dpkg-vendor --query vendor),Ubuntu)
	dh_gencontrol -- -Vmedia-server:Depends='dleyna-server [linux-any]'
else
	dh_gencontrol
endif
